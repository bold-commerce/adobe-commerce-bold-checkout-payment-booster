<?php
use Magento\Framework\View\Element\Template;
use Bold\CheckoutPaymentBooster\ViewModel\ExpressPay;

/** @var Template $block */

/** @var ExpressPay $expressPayViewModel */
$expressPayViewModel = $block->getData('express_pay_view_model');
$expressPayViewModel->initializeCheckoutData();
$websiteId = $expressPayViewModel->getWebsiteId();
$isEnabled = $expressPayViewModel->isCartWalletPayEnabled($websiteId);
?>

<?php if ($isEnabled): ?>
    <script>
        if (!window.checkoutConfig) {
            window.checkoutConfig = {};
        }
    
        const newCheckoutConfig = <?= $expressPayViewModel->getJsLayout() ?>;
        Object.assign(window.checkoutConfig, newCheckoutConfig.checkoutConfig);
    </script>
    <script type="text/x-magento-init">
    {
        "#express-pay-container": {
            "Bold_CheckoutPaymentBooster/js/express-pay-storefront": {
                "boldCheckoutConfig": <?= json_encode($block->escapeHtml($expressPayViewModel->initConfig()))  ?>
            }
        }
    }
    </script>
    <div id="express-pay-container" data-testid="express-pay-container">
        <p class="step-title"><?= $block->escapeHtml(__('Express Pay')) ?></p>
        <div id="express-pay-buttons"></div>
    </div>
<?php endif; ?>
